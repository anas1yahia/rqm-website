<header class="header-container" [class.scrolled-light]="isLightHeader">
  <!-- Right Section: Navigation, Logo, Language -->
  <div class="right-section">
    <!-- Language Switcher (First in Arabic/RTL) -->
    <div class="controls-wrapper hidden-mobile">
      <!-- Theme Switcher -->
      <app-button variant="theme" (onClick)="themeService.toggleTheme()" ariaLabel="Toggle Theme">
        <lucide-icon [img]="themeService.currentTheme() === 'dark' ? SunIcon : MoonIcon" [size]="20" strokeWidth="1.5"></lucide-icon>
      </app-button>

      <div class="lang-switcher">
        <div class="divider-bg">
          <img [src]="backgroundBorder" alt="">
        </div>
        <div class="toggle-container">
          <app-button variant="lang" [active]="currentLang === 'ar'" (onClick)="switchLanguage('ar')">
            <span>عربي</span>
          </app-button>
          <app-button variant="lang" [active]="currentLang === 'en'" (onClick)="switchLanguage('en')">
            <span>EN</span>
          </app-button>
        </div>
      </div>
    </div>

    <div class="nav-and-logo">
      <div class="logo-wrapper">
        <img [src]="currentLogo" alt="Rqm Logo" class="logo-img">
      </div>
      <!-- Desktop Navigation -->
      <nav class="navigation desktop-nav">
        <a [routerLink]="['/', currentLang]" fragment="home" class="nav-link">{{ 'HEADER.HOME' | translate }}</a>
        <a [routerLink]="['/', currentLang, 'our-story']" class="nav-link">{{ 'HEADER.ABOUT' | translate }}</a>
        
        <!-- Products Mega Menu Trigger -->
        <div class="nav-item-wrapper" (mouseenter)="toggleProductsMenu(true)" (mouseleave)="toggleProductsMenu(false)">
          <button class="nav-link products-btn" [class.active]="isProductsMenuOpen">
            {{ 'HEADER.PRODUCTS' | translate }}
            <lucide-icon name="chevron-down" [size]="16" class="chevron-icon"></lucide-icon>
          </button>
          
          <!-- Mega Menu Dropdown -->
          <div class="mega-menu-container" [@megaMenuState]="isProductsMenuOpen ? 'open' : 'closed'">
             <div class="mega-menu-content">
                <!-- Product 1 -->
                <app-product-card
                  [title]="'LANDING.PRODUCTS.QAID_TITLE' | translate"
                  [description]="'LANDING.PRODUCTS.QAID_DESC' | translate"
                  [features]="[
                    'LANDING.PRODUCTS.QAID_FEATURE_1' | translate,
                    'LANDING.PRODUCTS.QAID_FEATURE_2' | translate,
                    'LANDING.PRODUCTS.QAID_FEATURE_3' | translate
                  ]"
                  logo="ayd.svg"
                  themeColor="#4c89d5">
                </app-product-card>

                <!-- Product 2 -->
                <app-product-card
                  [title]="'LANDING.PRODUCTS.QAID_SUBTITLE' | translate"
                  [description]="'LANDING.PRODUCTS.QAID_DESC' | translate"
                  [features]="[
                    'LANDING.PRODUCTS.QAID_FEATURE_4' | translate,
                    'LANDING.PRODUCTS.QAID_FEATURE_5' | translate,
                    'LANDING.PRODUCTS.QAID_FEATURE_6' | translate
                  ]"
                  logo="captech.svg"
                  themeColor="#62c4aa">
                </app-product-card>

                <!-- Product 3 -->
                <app-product-card
                  [isSmall]="true"
                  logo="more.svg"
                  themeColor="#756cea">
                </app-product-card>
             </div>
          </div>
        </div>

        <a [routerLink]="['/', currentLang, 'services']" class="nav-link">{{ 'HEADER.SERVICES' | translate }}</a>
        <a [routerLink]="['/', currentLang, 'contact-us']" class="nav-link">{{ 'HEADER.CONTACT_US' | translate }}</a>
      </nav>
    </div>
  </div>

  <!-- Mobile Burger Button -->
  <app-button variant="burger" class="burger-btn" (onClick)="toggleMenu()" ariaLabel="Toggle menu">
    <lucide-icon [img]="isMenuOpen ? XIcon : MenuIcon" [size]="24" strokeWidth="2" color="white"></lucide-icon>
  </app-button>

  <!-- Contact Us CTA (Visible on Desktop, maybe moved/hidden on mobile depending on space) -->
  <app-button variant="contact" class="contact-cta hidden-mobile" [routerLink]="['/', currentLang, 'contact-us']">
    <div class="contact-wrapper">
       <p>{{ 'HEADER.CONTACT_US' | translate }}</p>
    </div>
  </app-button>
</header>

<!-- Mobile Menu Overlay -->
<div class="mobile-menu-overlay" *ngIf="isMenuOpen" @menuState (click)="toggleMenu()">
  <div class="mobile-menu-content" @sheetState @navItems (click)="$event.stopPropagation()">
    <nav class="mobile-nav">
      <a [routerLink]="['/', currentLang]" fragment="home" class="mobile-nav-link" (click)="toggleMenu()">{{ 'HEADER.HOME' | translate }}</a>
      <a [routerLink]="['/', currentLang, 'our-story']" class="mobile-nav-link" (click)="toggleMenu()">{{ 'HEADER.ABOUT' | translate }}</a>
      <a [routerLink]="['/', currentLang, 'services']" class="mobile-nav-link" (click)="toggleMenu()">{{ 'HEADER.SERVICES' | translate }}</a>
      <a [routerLink]="['/', currentLang, 'contact-us']" class="mobile-nav-link" (click)="toggleMenu()">{{ 'HEADER.CONTACT_US' | translate }}</a>
    </nav>

    <!-- Mobile Theme Switcher -->
    <div class="mobile-theme-switcher">
      <app-button variant="theme" (onClick)="themeService.toggleTheme()" ariaLabel="Toggle Theme">
        <lucide-icon [img]="themeService.currentTheme() === 'dark' ? SunIcon : MoonIcon" [size]="24" strokeWidth="1.5"></lucide-icon>
      </app-button>
    </div>

    <!-- Mobile Lang Switcher inside menu -->
    <div class="mobile-lang-switcher">
        <app-button variant="lang" [active]="currentLang === 'ar'" (onClick)="switchLanguage('ar')">
          <span>عربي</span>
        </app-button>
        <app-button variant="lang" [active]="currentLang === 'en'" (onClick)="switchLanguage('en')">
          <span>EN</span>
        </app-button>
    </div>
  </div>
</div>
